/*! asRange - v0.2.0 - 2014-05-28
* https://github.com/amazingSurge/jquery-asRange
* Copyright (c) 2014 amazingSurge; Licensed GPL */
(function(t){function e(e,i,n){this.$element=e,this.uid=i,this.parent=n,this.options=t.extend(!0,{},this.parent.options),this.direction=this.options.direction,this.value=null,this.classes={active:this.parent.namespace+"-pointer_active"}}var i="asRange",n={namespace:"asRange",skin:null,max:100,min:0,value:null,step:10,limit:!0,range:!1,direction:"h",keyboard:!0,replaceFirst:"default",tip:!0,scale:!0,format:function(t){return t},onChange:function(){},callback:function(){}},s=function(t){return t.touches&&(t=t.touches[0]),t},a=t[i]=function(e,i){var s={},a={v:{page:"pageY",position:"top"},h:{page:"pageX",position:"left"}};if(this.element=e,this.$element=t(e),this.$element.is("input")){var o=this.$element.val();"string"==typeof o&&(s.value=o.split(","));var r=this;t.each(["min","max","step"],function(t,e){var i=parseFloat(r.$element.attr(e));isNaN(i)||(s[e]=i)}),this.$element.css({display:"none"}),this.$wrap=t("<div></div>"),this.$element.after(this.$wrap)}else this.$wrap=this.$element;if(this.options=t.extend({},n,i,this.$element.data(),s),this.namespace=this.options.namespace,this.components=t.extend(!0,{},this.components),this.value=this.options.value,null===this.value&&(this.value=this.options.min),this.options.range?t.isArray(this.value)?1===this.value.length&&(this.value[1]=this.value[0]):this.value=[this.value,this.value]:t.isArray(this.value)&&(this.value=this.value[0]),this.min=this.options.min,this.max=this.options.max,this.step=this.options.step,this.interval=this.max-this.min,this.initialized=!1,this.updating=!1,this.disabled=!1,this.page=a[this.options.direction].page,this.position=a[this.options.direction].position,this.$wrap.addClass(this.namespace),this.options.skin&&this.$wrap.addClass(this.namespace+"_"+this.options.skin),this.max<this.min||this.step>=this.interval)throw Error("error options about max min step");this.init()};a.prototype={constructor:a,components:{},init:function(){this.$wrap.append('<div class="'+this.namespace+'-bar" />'),this.buildPointers(),this.components.selected.init(this),this.options.tip!==!1&&this.components.tip.init(this),this.options.scale!==!1&&this.components.scale.init(this),this.set(this.value),this.bindEvents(),this.$element.trigger("asRange::ready",this),this.initialized=!0},buildPointers:function(){this.pointer=[];var i=1;this.options.range&&(i=2);for(var n=1;i>=n;n++){var s=t('<div class="'+this.namespace+"-pointer "+this.namespace+"-pointer-"+n+'"></div>').appendTo(this.$wrap),a=new e(s,n,this);this.pointer.push(a)}this.p1=this.pointer[0],this.options.range&&(this.p2=this.pointer[1])},bindEvents:function(){var e=this;this.$wrap.on("touchstart.asRange mousedown.asRange",function(t){t=s(t);var i=t.which?3===t.which:2===t.button;if(i&&!Touch)return!1;var n=e.$wrap.offset(),a=t[e.page]-n[e.position],o=e.getAdjacentPointer.call(e,a);return o.mousedown.call(o,t),!1}),this.$element.is("input")&&this.$element.on("asRange::change",function(){var t=e.get();e.$element.val(t)}),t.each(this.pointer,function(t,i){i.$element.on("asRange::pointer::change",function(){return e.value=e.get(),!e.initialized||e.updating?!1:("function"==typeof e.options.onChange&&e.options.onChange.call(e,e.value,i.uid),e.$element.trigger("asRange::change",e),!1)})})},getAdjacentPointer:function(t){var e=t/this.getLength();if(this.options.range){var i=this.p1.value,n=this.p2.value,s=Math.abs(i-n);return n>=i?e>i+s/2?this.p2:this.p1:e>n+s/2?this.p1:this.p2}return this.p1},getLength:function(){return"v"===this.direction?this.$wrap.height():this.$wrap.width()},update:function(e){var i=this;this.updating=!0,t.each(["max","min","step","limit","value"],function(t,n){e[n]&&(i[n]=e[n])}),(e.max||e.min)&&this.setInterval(e.min,e.max),e.value||(this.value=e.min),t.each(this.components,function(t,e){"function"==typeof e.update&&e.update(i)}),this.set(this.value),"function"==typeof i.options.onUpdate&&i.options.onUpdate.call(i),i.$element.trigger("asRange::update",i),this.updating=!1},get:function(){var e=this,i=[],n=e.step,s=(""+n).split(".")[1]?(""+n).split(".")[1].length:0;return t.each(this.pointer,function(t,n){var a=n.get()*e.interval+e.min;a=Math.round(a/e.step)*e.step,s>0&&(a=parseFloat(a.toFixed(s))),i[t]=a}),e.options.range?i:i[0]},set:function(e){if(this.options.range){if("number"==typeof e&&(e=[e]),!t.isArray(e))return;t.each(this.pointer,function(t,i){i.set("actual",e[t])})}else this.p1.set("actual",e);this.value=e},val:function(t){return t?(this.set(t),this):this.get()},setInterval:function(t,e){this.min=t,this.max=e,this.interval=e-t},enable:function(){return this.disabled=!1,this.$wrap.removeClass(this.namespace+"_disabled"),this},disable:function(){return this.disabled=!0,this.$wrap.addClass(this.namespace+"_disabled"),this},destroy:function(){t.each(this.pointer,function(t,e){e.destroy()}),this.$wrap.destroy()}},a.defaults=n,a.registerComponent=function(t,e){a.prototype.components[t]=e},e.prototype={constructor:e,mousedown:function(e){var i,n,a=this.parent.$wrap.offset();if(this.parent.enabled!==!1)return this.$element.trigger("asRange::pointer::start",this),i=this.parent.page,n=this.parent.position,this.data={},this.data.start=e[i],this.data[n]=e[i]-a[n],this.set("px",this.data[n]),t.each(this.parent.pointer,function(t,e){e.deactive()}),this.active(),this.mousemove=function(t){var e=t,a=s(t),o=this.data[n]+(a[i]||this.data.start)-this.data.start;return this.set("px",o),e.preventDefault(),!1},this.mouseup=function(){return t(document).off("touchmove.asRange mousemove.asRange touchend.asRange mouseup.asRange"),this.$element.trigger("asRange::pointer::end",this),!1},t(document).on("touchmove.asRange mousemove.asRange",t.proxy(this.mousemove,this)).on("touchend.asRange mouseup.asRange",t.proxy(this.mouseup,this)),!1},active:function(){this.$element.addClass(this.classes.active)},deactive:function(){this.$element.removeClass(this.classes.active)},set:function(t,e){"px"===t&&(e/=this.parent.getLength()),"actual"===t&&(e=(e-this.parent.min)/this.parent.interval),"percent"===t&&(e=e),this._set(e)},_set:function(t){if(this.value!==t){t=Math.round(1e3*t)/1e3,this.parent.step>0&&(t=this.matchStep(t)),this.options.limit===!0?t=this.matchLimit(t):(0>=t&&(t=0),t>=1&&(t=1)),t=Math.round(1e3*t)/1e3,this.value=t;var e={};e[this.parent.position]=100*t+"%",this.$element.css(e),this.$element.focus(),this.$element.trigger("asRange::pointer::change",this)}},get:function(){return this.value},matchStep:function(t){var e=this.parent.step;return t=t*this.parent.interval+this.parent.min,t=Math.round(t/e)*e,(t-this.parent.min)/this.parent.interval},matchLimit:function(t){var e,i,n=this.parent.pointer;return e=1===this.uid?0:n[this.uid-2].value,i=n[this.uid]?n[this.uid].value:1,e>=t&&(t=e),t>=i&&(t=i),t},destroy:function(){this.$element.off(".asRange"),this.$element.remove()}},t.fn.asRange=function(e){if("string"!=typeof e)return this.each(function(){t.data(this,i)||t.data(this,i,new a(this,e))});var n=e,s=arguments.length>1?Array.prototype.slice.call(arguments,1):void 0;if(/^\_/.test(n))return!1;if(!(/^(get)$/.test(n)||"val"===n&&void 0===s))return this.each(function(){var e=t.data(this,i);e&&"function"==typeof e[n]&&e[n].apply(e,s)});var o=this.first().data(i);return o&&"function"==typeof o[n]?o[n].apply(o,s):void 0}})(jQuery),function(t){t.asRange.registerComponent("scale",{defaults:{scale:{valuesNumber:3,gap:1,grid:5}},init:function(e){var i=t.extend({},this.defaults,e.options.scale),n=i.scale;i.values=[],i.values.push(e.min);for(var s=(e.max-e.min)/(i.valuesNumber-1),a=1;i.valuesNumber-2>=a;a++)i.values.push(s*a);i.values.push(e.max);var o={scale:e.namespace+"-scale",lines:e.namespace+"-scale-lines",grid:e.namespace+"-scale-grid",inlineGrid:e.namespace+"-scale-inlineGrid",values:e.namespace+"-scale-values"},r=n.values.length,h=((n.grid-1)*(n.gap+1)+n.gap)*(r-1)+r,p=100/(h-1),u=100/(r-1);this.$scale=t("<div></div>").addClass(o.scale),this.$lines=t("<ul></ul>").addClass(o.lines),this.$values=t("<ul></ul>").addClass(o.values);for(var l=0;h>l;l++){var c;c=0===l||l===h||0===l%((h-1)/(r-1))?t('<li class="'+o.grid+'"></li>'):0===l%n.grid?t('<li class="'+o.inlineGrid+'"></li>'):t("<li></li>"),c.css({left:p*l+"%"}).appendTo(this.$lines)}for(var d=0;r>d;d++)t("<li><span>"+n.values[d]+"</span></li>").css({left:u*d+"%"}).appendTo(this.$values);this.$lines.add(this.$values).appendTo(this.$scale),this.$scale.appendTo(e.$wrap)},update:function(t){this.$scale.remove(),this.init(t)}})}(jQuery),function(t){t.asRange.registerComponent("selected",{defaults:{},init:function(e){var i=this;this.$arrow=t("<span></span>").appendTo(e.$wrap),this.$arrow.addClass(e.namespace+"-selected"),e.options.range===!1&&e.pointer[0].$element.on("asRange::pointer::change",function(t,e){var n=0,s=e.get();i.$arrow.css({left:0,width:100*(s-n)+"%"})}),e.options.range===!0&&(e.pointer[0].$element.on("asRange::pointer::change",function(t,n){var s=n.get(),a=e.pointer[1].get();i.$arrow.css({left:100*Math.min(s,a)+"%",width:100*Math.abs(a-s)+"%"})}),e.pointer[1].$element.on("asRange::pointer::change",function(t,n){var s=n.get(),a=e.pointer[0].get();i.$arrow.css({left:100*Math.min(a,s)+"%",width:100*Math.abs(s-a)+"%"})}))}})}(jQuery),function(t){t.asRange.registerComponent("tip",{defaults:{active:"always"},init:function(e){var i=this,n=t.extend({},this.defaults,e.options.tip);this.opts=n,this.classes={tip:e.namespace+"-tip",show:e.namespace+"-tip-show"},t.each(e.pointer,function(n,s){var a=t("<span></span>").appendTo(e.pointer[n].$element);a.addClass(i.classes.tip),"onMove"===i.opts.active&&(a.css({display:"none"}),s.$element.on("asRange::pointer::end",function(){return i.hide(a),!1}).on("asRange::pointer::start",function(){return i.show(a),!1})),s.$element.on("asRange::pointer::change",function(){var t;return t=e.options.range?e.get()[n]:e.get(),"function"==typeof e.options.format&&(t=e.options.format(t)),a.text(t),!1})})},show:function(t){t.addClass(this.classes.show),t.css({display:"block"})},hide:function(t){t.removeClass(this.classes.show),t.css({display:"none"})}})}(jQuery),function(t,e,i){var n=i(e);n.on("asRange::ready",function(t,e){var s,a={keys:{UP:38,DOWN:40,LEFT:37,RIGHT:39,RETURN:13,ESCAPE:27,BACKSPACE:8,SPACE:32},map:{},bound:!1,press:function(t){var e=t.keyCode||t.which;return e in a.map&&"function"==typeof a.map[e]?(a.map[e](t),!1):undefined},attach:function(t){var e,i;for(e in t)t.hasOwnProperty(e)&&(i=e.toUpperCase(),i in a.keys?a.map[a.keys[i]]=t[e]:a.map[i]=t[e]);a.bound||(a.bound=!0,n.bind("keydown",a.press))},detach:function(){a.bound=!1,a.map={},n.unbind("keydown",a.press)}};e.options.keyboard===!0&&i.each(e.pointer,function(t,i){s=e.options.step>0?e.options.step/e.interval:.01;var n=function(){var t=i.value;i.set("percent",t-s)},o=function(){var t=i.value;i.set("percent",t+s)};i.$element.attr("tabindex","0").on("focus",function(){return a.attach({left:n,right:o}),!1}).on("blur",function(){return a.detach(),!1})})})}(window,document,jQuery);